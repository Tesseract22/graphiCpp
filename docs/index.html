<!DOCTYPE html>
<script>

    async function loadModule(url = "index.wasm") {
        const module = await WebAssembly.instantiateStreaming(
            fetch(url)
        );
        return module;
    }


    async function loadDemo(module, id) {


        console.log(module);
        const exports = module.instance.exports;
        const memory = exports.memory.buffer;

        const H = exports.HEIGHT();
        const W = exports.WIDTH();
        console.log(H, W);
        const cv = new ImageData(new Uint8ClampedArray(memory, exports["cv"], H * W * 4), W);

        exports.main();
        console.log(cv)
        const canvas = document.getElementById(id);
        const ctx = canvas.getContext("2d");
        canvas.width = W;
        canvas.height = H;
        ctx.putImageData(cv, 0, 0);
    };
    loadModule("basic.wasm").then((module) => {
        loadDemo(module, "basic")
    })
    loadModule("color.wasm").then((module) => {
        loadDemo(module, "color")
    })


</script>
<canvas id="basic"></canvas>
<canvas id="color"></canvas>